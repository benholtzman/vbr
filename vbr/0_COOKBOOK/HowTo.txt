There are many ways to use these codes, depending on what kinds of measurements you are trying to fit. Here we go through the simplest, which is just to fit a 1D Vs profile.

**** RUN FORWARD MODELS **************

Go to vbr/vbr/2_PLATES/4pt0_1d_plates/
1) Open DRIVE_SVFM_Plate_Model ( or _par = parallel, if you want to run models in parallel)-- or use one of the other forward models (DRIVE_SVFM_Halfspace_Cooling if looking at near ridge oceanic models)

2) Look at ./00_init_conds/init_settings.m and see what you can modify...
modify it either here, or, if you want to loop over a range of values in calculating forward models, do that in the DRIVE file, where the values in init_settings will be overwritten.

3) Before running the DRIVE, make new name for the directory in which the results will be written (a "Box"-- the data structure containing all the run results and information about them). It is designed so that this directory is *NOT* in the git repository.

**** RUN THE VBR CALCULATOR on that box ************

1) DRIVE_VBR
Line 17,18: turn melt on or off (we need to clarify what these two do).
Line 21: GIA set to 0, unless doing GIA time scale calcs (needs a flag only for box naming purposes)
Line 27: Set the Box base name.
Line 32: Set the directory where the Box is (and make sure it ends with /).

NOTE that any variable going in to the VBR can be modified by overwriting VBR.in.[var] in a loop. If this variables was coupled to the forward model, this is a nono (like T). But if the forward model was not calculating that variable self-consistently (to whatever degree), then no problem, such as grain size in a cooling plate model.


**** FIT THE MEASUREMENT ***************************
Here, there are several existing options and many not yet taken.

1) DRIVE_fitLABdepth
In the case where there is a receiver function result that is consistent with an LAB (or hypothesized to be), you can fit that first, searching for the value of the zPlate that gives the best zLAB. Script includes plotting. Need to change your paths.

2) DRIVE_TNA_SNA_fit.m
In the case where you want to fit a Vs profile, from body or surface waves. but absolute velocities, use this as a template. Get the seismic measurements into the form of those for SNA and TNA (see the path in the code), then adapt the script to your needs. There are many fitting procedure scripts necessary.. too many to go through here. The most important thing here is changing the shape of the weighting function in Lines 45-47.

**** ADD MELT AND RE-FIT ***************************

Now you can explore the effect of melt, to determine a melt-temperature tradeoff. At present, we take the best fitting plate thickness, and keep the potential temp as an unknown.. Then we add a new set of prior models constructed with a range of melt fractions (ramping up across the LAB).

1) DRIVE_AddMelt
2) DRIVE_VBR (with wMelt_flag = 1)
3) DRIVE_TNA_SNA_fit (with wMelt_flag = 1)


=======================
TO DO
=======================
BH: Add Takei's parameterization and scaling ! 

DRIVE_AddMelt and DRIVE_fitLABdepth both need to have the local "Work.[var]" structure added to them.

When adding melt, and then redoing the TNA-SNA fit, the shape of the matrix is changed, such that the fitting plot shows the wrong variable name (plate thicness, not temperatur-- though at a quick look the values look correct.
